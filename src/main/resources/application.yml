spring:
  datasource:
    # 方式一：内存数据库 (数据不持久化，每次重启丢失) - 适合开发和测试
    # url: jdbc:h2:mem:edge_sensor_data;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    # 方式二：文件数据库 (数据持久化到文件，推荐用于生产边缘设备)
    url: jdbc:h2:file:./data/edge_sensor_data_h2;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    driver-class-name: org.h2.Driver
    username: sa # H2 默认用户名
    password:    # H2 默认密码，可以为空
    hikari:
      connection-timeout: 20000
      maximum-pool-size: 10 # H2 可以适当增加连接池大小，例如 10-20
      # H2 默认支持 MVCC，无需像 SQLite 那样设置journal_mode
  jpa:
    hibernate:
      ddl-auto: create # 启动时自动创建表。如果是生产环境，可能需要改为 update 或 validate
    properties:
      hibernate:
        dialect: org.hibernate.dialect.H2Dialect
    show-sql: false

  h2:
    console:
      enabled: true   # 启用 H2 Web 控制台
      path: /h2-console # 控制台的访问路径，默认为 /h2-console

server:
  port: 8081

# ==================== 重点：多串口 + 多传感器配置 ====================
modbus:
  # 全局默认串口参数（下面没单独写的都会继承这里）
  serial:
    baudRate: 57600
    dataBits: 8
    stopBits: 1
    parity: 0      # 0=None
    encoding: RTU
    pollIntervalMs: 100  # 全局轮询间隔，用于实时采集

    # ------------------ 多个物理串口定义 ------------------
    connections:
      # 串口1：纯温度传感器 × 3
      - name: "temp-only"               # 内部引用名，随便起
        port: "COM8"
#        port: "/dev/ttyACM0"
        baudRate: 57600                 # 可单独覆盖全局

      # 串口2：温湿度+气压一体传感器 × 3
    #      - name: "thp-combo"               # 内部引用名
    #        port: "/dev/ttyUSB0"
    #        baudRate: 9600                  # 假设一体传感器波特率是9600，根据实际改

    # ------------------ 所有传感器列表 ------------------
    sensors:
      # ---------- 串口1：3个纯温度传感器 ----------
#      - sensorId: "cold-room-01"
#        sensorName: "冷藏库1号"
#        connection: "temp-only"        # 对应上面 connections 的 name
#        slaveId: 1
#        temperature:
#          registerType: "holding"      # holding 或 input
#          address: 0
#          dataType: 5                  # 5=FOUR_BYTE_INT_SIGNED（32位有符号），根据实际传感器手册改
#          scale: 0.0001
#          byteOrder: "ABCD"

      - sensorId: "cold-room-02"
        sensorName: "冷藏库2号"
        connection: "temp-only"
        slaveId: 2
        temperature:
          registerType: "holding"
          address: 0
          dataType: 5
          scale: 0.0001
          byteOrder: "ABCD"

      #      - sensorId: "freezer-01"
      #        sensorName: "冷冻库1号"
      #        connection: "temp-only"
      #        slaveId: 3
      #        temperature:
      #          registerType: "holding"
      #          address: 0
      #          dataType: 5
      #          scale: 0.0001
      #          byteOrder: "ABCD"
      #
      #      # ---------- 串口2：3个温湿度+气压一体传感器 ----------
      #      - sensorId: "env-01"
      #        sensorName: "环境监测点1"
      #        connection: "thp-combo"
      #        slaveId: 1
      #        temperature:
      #          registerType: "holding"
      #          address: 0                   # 假设温度在寄存器0
      #          dataType: 5
      #          scale: 0.0001
      #          byteOrder: "ABCD"
      #        humidity:
      #          registerType: "holding"
      #          address: 1                   # 湿度在寄存器1
      #          dataType: 5
      #          scale: 0.0001
      #          byteOrder: "ABCD"
      #        pressure:
      #          registerType: "holding"
      #          address: 2                   # 气压在寄存器2
      #          dataType: 5
      #          scale: 0.0001
      #          byteOrder: "ABCD"
      #
      #      - sensorId: "env-02"
      #        sensorName: "环境监测点2"
      #        connection: "thp-combo"
      #        slaveId: 2
      #        temperature:
      #          registerType: "holding"
      #          address: 0
      #          dataType: 5
      #          scale: 0.0001
      #          byteOrder: "ABCD"
      #        humidity:
      #          registerType: "holding"
      #          address: 1
      #          dataType: 5
      #          scale: 0.0001
      #          byteOrder: "ABCD"
      #        pressure:
      #          registerType: "holding"
      #          address: 2
      #          dataType: 5
      #          scale: 0.0001
      #          byteOrder: "ABCD"
      #
      #      - sensorId: "env-03"
      #        sensorName: "环境监测点3"
      #        connection: "thp-combo"
      #        slaveId: 3
      #        temperature:
      #          registerType: "holding"
      #          address: 0
      #          dataType: 5
      #          scale: 0.0001
      #          byteOrder: "ABCD"
      #        humidity:
      #          registerType: "holding"
      #          address: 1
      #          dataType: 5
      #          scale: 0.0001
      #          byteOrder: "ABCD"
      #        pressure:
      #          registerType: "holding"
      #          address: 2
      #          dataType: 5
      #          scale: 0.0001
      #          byteOrder: "ABCD"

      # 以后想再加第7、8、9...个传感器，直接在这里继续写就行

edge:
  deviceId: jetson-001

prediction:
  service:
    url: http://localhost:5000/predict
    trendUrl: http://localhost:5000/predict_trend
  trend:
    checkIntervalMs: 30000 # 趋势预测检查间隔，例如每 30 秒
    historyMinutes: 10     # 预测模型输入需要的回溯历史数据时长（分钟），例如过去 10 分钟
    horizonSeconds: 60     # 预测未来多长时间（秒），例如未来 60 秒

alarm:
  threshold:
    upper: 35.0
    lower: 5.0
    deviation: 3.0

#cloud:
#  upload:
#    url: http://localhost:8080/api/sensor-data # 指向 mockcloud 的单条数据上传接口
#    batchSize: 50
#    batchIntervalMs: 60000
#cloud.config.url: http://localhost:8080/api/device/{deviceId}/config # 指向 mockcloud 的配置获取接口

cloud:
  upload:
    url: http://100.79.184.120:8080/api/sensor-data # 指向朋友电脑的 Mock Cloud 的上传接口
    batchSize: 50
    batchIntervalMs: 60000
  config:
    url: http://100.79.184.120:8080/api/device/{deviceId}/config # 指向朋友电脑的 Mock Cloud 的配置接口


data:
  compaction:
    intervalMs: 60000 # 数据稀疏化任务每隔 1 分钟执行一次
  retention: # 数据保留策略
    realtimeMinutes: 20 # 秒级数据保留时长 (REALTIME)
    minutelyHours: 24 # 分钟级数据保留时长 (MINUTELY_COMPACTED)
    hourlyDays: 7 # 小时级数据保留时长 (HOURLY_COMPACTED)
